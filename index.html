<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MBTI ìºë¦­í„° ì‹œë®¬ë ˆì´í„° (ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€)</title>
    <style>
        /* 1. ë””ìì¸: ì‚°ëœ»í•˜ê³  ë°ì€ ëŠë‚Œ */
        :root {
            --primary: #4a90e2;
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-sub: #666;
            --danger: #ff6b6b;
            --edit: #f39c12;
        }

        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-main); }
        h1, h2 { color: var(--primary); margin-bottom: 10px; }
        
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-section { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e1e4e8; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end; }
        .input-box { flex: 1; }
        label { display: block; font-weight: bold; font-size: 0.9em; color: var(--text-sub); margin-bottom: 5px; }
        input[type="text"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        /* ìŠ¤íƒ¯ ë¶„ë°° ìŠ¤íƒ€ì¼ */
        .stat-dist-box { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .stat-input-group label { font-size: 0.85em; text-align: center; display: block; }
        .stat-input-group input { width: 100%; text-align: center; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-weight: bold; }
        .remain-point { text-align: right; font-size: 0.95em; margin-bottom: 8px; font-weight: bold; }
        .remain-point span { color: var(--primary); font-size: 1.3em; }
        .error-msg { color: var(--danger); font-size: 0.9em; display: none; margin-top: 5px; font-weight: bold;}

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { padding: 12px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background-color: var(--primary); color: white; width: 100%; }
        .btn-primary:hover { background-color: #357abd; }
        .btn-secondary { background-color: #e2e8f0; color: #333; }
        .btn-sm { padding: 8px 15px; width: auto; }

        /* ìºë¦­í„° ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .char-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; }
        .char-card { background: #fafafa; border: 1px solid #eee; padding: 15px; border-radius: 10px; position: relative; transition: transform 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .char-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .char-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .char-name { font-size: 1.2em; font-weight: bold; color: #333; }
        .char-mbti { font-size: 0.85em; background: #eaf4ff; color: var(--primary); padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        
        .stat-row { display: flex; justify-content: space-between; font-size: 0.8em; color: #555; margin-top: 4px; }
        .bar-bg { background: #eee; height: 6px; border-radius: 3px; margin-top: 2px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        /* ì¹´ë“œ ê´€ë¦¬ ë²„íŠ¼ (ìˆ˜ì •/ì‚­ì œ) */
        .card-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; }
        .action-btn { width: 24px; height: 24px; border-radius: 4px; border: none; color: white; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-edit { background-color: var(--edit); }
        .btn-del { background-color: var(--danger); }
        .btn-edit:hover { background-color: #d68910; }
        .btn-del:hover { background-color: #c0392b; }

        /* ë¡œê·¸ ìŠ¤íƒ€ì¼ */
        #log-window { height: 400px; overflow-y: auto; background: #fafafa; border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-top: 20px; font-size: 0.95em; line-height: 1.6; }
        .log-entry { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dashed #e0e0e0; }
        .log-day { font-weight: bold; color: var(--primary); margin-top: 15px; display: block; background: #eaf4ff; padding: 5px 10px; border-radius: 5px; }
        .tag-event { font-weight: bold; } 
    </style>
</head>
<body>

    <div class="container">
        <div id="page-setup" class="page active">
            <h1>ğŸ“ ìºë¦­í„° ë“±ë¡ ë° ê´€ë¦¬</h1>
            <p>ìºë¦­í„°ë¥¼ ìƒì„±í•˜ê³  í•˜ë‹¨ ëª©ë¡ì—ì„œ ë°”ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.</p>
            
            <div class="input-section">
                <div class="input-group">
                    <div class="input-box">
                        <label>ì´ë¦„</label>
                        <input type="text" id="input-name" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜">
                    </div>
                    <div class="input-box">
                        <label>MBTI</label>
                        <select id="input-mbti">
                            <option value="ISTJ">ISTJ (ê´€ë¦¬ì)</option>
                            <option value="ISFJ">ISFJ (ìˆ˜í˜¸ì)</option>
                            <option value="INFJ">INFJ (ì„ ì§€ì)</option>
                            <option value="INTJ">INTJ (ì „ëµê°€)</option>
                            <option value="ISTP">ISTP (ì¬ì£¼ê¾¼)</option>
                            <option value="ISFP">ISFP (ì˜ˆìˆ ê°€)</option>
                            <option value="INFP">INFP (ì¤‘ì¬ì)</option>
                            <option value="INTP">INTP (ì‚¬ìƒ‰ê°€)</option>
                            <option value="ESTP">ESTP (ì‚¬ì—…ê°€)</option>
                            <option value="ESFP">ESFP (ììœ ì¸)</option>
                            <option value="ENFP">ENFP (í™œë™ê°€)</option>
                            <option value="ENTP">ENTP (ë³€ë¡ ê°€)</option>
                            <option value="ESTJ">ESTJ (ê²½ì˜ì)</option>
                            <option value="ESFJ">ESFJ (ì™¸êµê´€)</option>
                            <option value="ENFJ">ENFJ (ìš´ë™ê°€)</option>
                            <option value="ENTJ">ENTJ (í†µì†”ì)</option>
                        </select>
                    </div>
                </div>

                <div class="remain-point">ë‚¨ì€ í¬ì¸íŠ¸: <span id="remain-val">100</span> / 100</div>
                <div class="stat-dist-box">
                    <div class="stat-input-group">
                        <label>ê·¼ë ¥</label>
                        <input type="number" id="stat-str" value="0" min="0" oninput="checkPoints()">
                    </div>
                    <div class="stat-input-group">
                        <label>ìˆœë°œë ¥</label>
                        <input type="number" id="stat-agi" value="0" min="0" oninput="checkPoints()">
                    </div>
                    <div class="stat-input-group">
                        <label>ê³µê²©ì„±</label>
                        <input type="number" id="stat-agg" value="0" min="0" oninput="checkPoints()">
                    </div>
                    <div class="stat-input-group">
                        <label>ëŠ¥ë™ì„±</label>
                        <input type="number" id="stat-act" value="0" min="0" oninput="checkPoints()">
                    </div>
                </div>
                <div id="point-error" class="error-msg">âš ï¸ í¬ì¸íŠ¸ í•©ê³„ê°€ 100ì´ì–´ì•¼ í•©ë‹ˆë‹¤!</div>
                <br>
                <button class="btn-primary" onclick="addCharacter()">ğŸ”½ ìºë¦­í„° ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€</button>
            </div>

            <h3>ë“±ë¡ëœ ìºë¦­í„° (<span id="char-count">0</span>ëª…)</h3>
            <div id="char-list" class="char-grid">
                </div>

            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
            <button class="btn-primary" style="background:#2ecc71; height: 50px; font-size: 1.1em;" onclick="startGame()">ğŸš€ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="page-sim" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>ğŸ“º ìƒí™© ì‹œë®¬ë ˆì´í„°</h1>
                <button class="btn-secondary btn-sm" onclick="stopGame()">âš™ï¸ ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div style="display:flex; gap:10px; margin-bottom:10px; margin-top:10px;">
                <button class="btn-primary" onclick="nextTurn()">ğŸ“… 1ì¼ ì§„í–‰</button>
                <button class="btn-secondary" onclick="autoPlay()">â© ìë™ ì§„í–‰</button>
            </div>

            <div id="log-window">
                <div class="log-entry" style="color:#999;">ìºë¦­í„°ë“¤ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤... '1ì¼ ì§„í–‰' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
            </div>

            <h3>ğŸ“Š í˜„ì¬ ìƒì¡´ì í˜„í™©</h3>
            <div id="sim-status" class="char-grid">
                </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. í¬ì¸íŠ¸ ë¶„ë°° ë° ìœ íš¨ì„± ê²€ì‚¬
        // ==========================================
        const MAX_POINT = 100;

        function checkPoints() {
            const str = Number(document.getElementById('stat-str').value) || 0;
            const agi = Number(document.getElementById('stat-agi').value) || 0;
            const agg = Number(document.getElementById('stat-agg').value) || 0;
            const act = Number(document.getElementById('stat-act').value) || 0;

            const total = str + agi + agg + act;
            const remain = MAX_POINT - total;
            const remainSpan = document.getElementById('remain-val');
            
            remainSpan.innerText = remain;

            if (remain < 0) {
                remainSpan.style.color = "red";
                document.getElementById('point-error').style.display = "block";
                document.getElementById('point-error').innerText = `âš ï¸ í¬ì¸íŠ¸ ì´ˆê³¼! (${Math.abs(remain)}ì  ì¤„ì´ì„¸ìš”)`;
            } else if (remain > 0) {
                remainSpan.style.color = "#4a90e2";
                document.getElementById('point-error').style.display = "none";
            } else {
                remainSpan.style.color = "green"; 
                document.getElementById('point-error').style.display = "none";
            }
            return remain;
        }

        // ==========================================
        // 2. ë°ì´í„° ê´€ë¦¬
        // ==========================================
        let characters = []; 
        let day = 0; 
        let isAutoPlaying = false;

        function calculateStats(mbti, bonusStats) {
            let stats = {
                hp: 100, maxHp: 100,
                sanity: 100, maxSanity: 100,
                stamina: 100, maxStamina: 100,
                
                // ê¸°ë³¸ 30 + MBTI ê°€ì¤‘ì¹˜
                strength: 30, agility: 30, aggro: 30, active: 30, conscience: 50 
            };

            const chars = mbti.split('');
            if (chars[0] === 'E') stats.active += 40; else stats.sanity += 20;
            if (chars[1] === 'S') stats.stamina += 30; else stats.conscience += 20;
            if (chars[2] === 'T') stats.aggro += 40; else stats.conscience += 30;
            if (chars[3] === 'J') stats.strength += 30; else stats.agility += 30;

            // ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ í•©ì‚°
            stats.strength += bonusStats.str;
            stats.agility += bonusStats.agi;
            stats.aggro += bonusStats.agg;
            stats.active += bonusStats.act;

            return stats;
        }

        // ==========================================
        // 3. ìºë¦­í„° ë“±ë¡ / ìˆ˜ì • / ì‚­ì œ
        // ==========================================
        function addCharacter() {
            const name = document.getElementById('input-name').value;
            const mbti = document.getElementById('input-mbti').value;
            
            if (checkPoints() !== 0) return alert("ì¶”ê°€ í¬ì¸íŠ¸ í•©ê³„ê°€ ì •í™•íˆ 100ì´ì–´ì•¼ í•©ë‹ˆë‹¤!");
            if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            // ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ì„ ë”°ë¡œ ì €ì¥í•´ë‘¬ì•¼ ë‚˜ì¤‘ì— ìˆ˜ì •í•  ë•Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ
            const bonusStats = {
                str: Number(document.getElementById('stat-str').value),
                agi: Number(document.getElementById('stat-agi').value),
                agg: Number(document.getElementById('stat-agg').value),
                act: Number(document.getElementById('stat-act').value)
            };

            const stats = calculateStats(mbti, bonusStats);
            
            const newChar = {
                id: Date.now(), // ê³ ìœ  ID
                name: name,
                mbti: mbti,
                bonusStats: bonusStats, // ìˆ˜ì •ìš© ë°ì´í„° ì›ë³¸
                stats: stats,
                relations: {} 
            };

            characters.push(newChar);
            renderCharList();
            
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            resetInputForm();
        }

        function deleteCharacter(id) {
            if(confirm("ì •ë§ ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                characters = characters.filter(c => c.id !== id);
                renderCharList();
            }
        }

        function editCharacter(id) {
            // ìˆ˜ì •í•  ìºë¦­í„° ì°¾ê¸°
            const char = characters.find(c => c.id === id);
            if (!char) return;

            // ì…ë ¥ì°½ì— ê°’ ì±„ì›Œë„£ê¸°
            document.getElementById('input-name').value = char.name;
            document.getElementById('input-mbti').value = char.mbti;
            document.getElementById('stat-str').value = char.bonusStats.str;
            document.getElementById('stat-agi').value = char.bonusStats.agi;
            document.getElementById('stat-agg').value = char.bonusStats.agg;
            document.getElementById('stat-act').value = char.bonusStats.act;

            // í¬ì¸íŠ¸ ê²€ì‚¬ ë‹¤ì‹œ ì‹¤í–‰í•´ì„œ ìˆ«ì ìƒ‰ê¹” ë§ì¶¤
            checkPoints();

            // ë¦¬ìŠ¤íŠ¸ì—ì„œëŠ” ì‚­ì œ (ìˆ˜ì • í›„ ë‹¤ì‹œ ë“±ë¡í•˜ê²Œ ìœ ë„)
            characters = characters.filter(c => c.id !== id);
            renderCharList();

            // ìŠ¤í¬ë¡¤ì„ ìœ„ë¡œ ì˜¬ë ¤ì¤Œ
            window.scrollTo({ top: 0, behavior: 'smooth' });
            alert("ìºë¦­í„° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ 'ë“±ë¡' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
        }

        function resetInputForm() {
            document.getElementById('input-name').value = ''; 
            document.getElementById('stat-str').value = 0;
            document.getElementById('stat-agi').value = 0;
            document.getElementById('stat-agg').value = 0;
            document.getElementById('stat-act').value = 0;
            checkPoints(); 
        }

        function renderCharList() {
            const list = document.getElementById('char-list');
            document.getElementById('char-count').innerText = characters.length;

            list.innerHTML = characters.map(c => `
                <div class="char-card">
                    <div class="card-actions">
                        <button class="action-btn btn-edit" onclick="editCharacter(${c.id})" title="ìˆ˜ì •">âœ</button>
                        <button class="action-btn btn-del" onclick="deleteCharacter(${c.id})" title="ì‚­ì œ">âœ•</button>
                    </div>
                    <div class="char-header">
                        <span class="char-name">${c.name}</span>
                        <span class="char-mbti">${c.mbti}</span>
                    </div>
                    <div class="stat-row"><span>ì²´ë ¥</span> <span>${c.stats.hp}</span></div>
                    <div class="stat-row"><span>ì •ì‹ : ${c.stats.sanity}</span> <span>ê³µê²©ì„±: ${c.stats.aggro}</span></div>
                    <div class="stat-row"><span>ê·¼ë ¥: ${c.stats.strength}</span> <span>ìˆœë°œë ¥: ${c.stats.agility}</span></div>
                    <div class="stat-row"><span>ëŠ¥ë™ì„±: ${c.stats.active}</span> <span>ì–‘ì‹¬: ${c.stats.conscience}</span></div>
                </div>
            `).join('');
        }

        // ==========================================
        // 4. ì‹œë®¬ë ˆì´ì…˜ ì—”ì§„
        // ==========================================
        function startGame() {
            if (characters.length < 2) return alert("ìµœì†Œ 2ëª…ì˜ ìºë¦­í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤!");
            
            // ê´€ê³„ë„ ì´ˆê¸°í™”
            characters.forEach(c1 => {
                characters.forEach(c2 => {
                    if (c1.id !== c2.id) {
                        if (!c1.relations[c2.name]) c1.relations[c2.name] = 0;
                    }
                });
            });

            document.getElementById('page-setup').classList.remove('active');
            document.getElementById('page-sim').classList.add('active');
            addLog(`ğŸ“¢ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì°¸ê°€ì: ${characters.length}ëª…`);
            updateSimStatus();
        }

        function stopGame() {
            if(confirm("ì‹œë®¬ë ˆì´ì…˜ì„ ì¢…ë£Œí•˜ê³  ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆê¹Œìš”? (ì§„í–‰ ìƒí™©ì€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)")) {
                document.getElementById('page-sim').classList.remove('active');
                document.getElementById('page-setup').classList.add('active');
                isAutoPlaying = false;
                // ìºë¦­í„° ìƒíƒœ(HP ë“±)ëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•Šê³  ìœ ì§€ë˜ê²Œ í•  ìˆ˜ë„ ìˆì§€ë§Œ, 
                // ë³´í†µ ë‹¤ì‹œ ì„¸íŒ…í•˜ëŸ¬ ê°€ë©´ ì´ˆê¸°í™”í•˜ëŠ”ê²Œ ê¹”ë”í•˜ë¯€ë¡œ ì¼ë‹¨ ìœ ì§€.
                // ì™„ì „ ì´ˆê¸°í™”ë¥¼ ì›í•˜ì‹œë©´ ìƒˆë¡œê³ ì¹¨ì´ ì œì¼ ë¹ ë¦„.
            }
        }

        function nextTurn() {
            day++;
            addLog(`<span class="log-day">ğŸŒ ${day}ì¼ì°¨ ì•„ì¹¨ì´ ë°ì•˜ìŠµë‹ˆë‹¤.</span>`);

            const survivors = characters.filter(c => c.stats.hp > 0);
            if (survivors.length < 1) {
                addLog("ğŸ’€ ìƒì¡´ìê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ.");
                return;
            }

            const eventCount = Math.max(1, Math.floor(survivors.length / 2));
            
            for(let i=0; i<eventCount; i++) {
                const actor = survivors[Math.floor(Math.random() * survivors.length)];
                let target = survivors[Math.floor(Math.random() * survivors.length)];
                
                while(survivors.length > 1 && actor.id === target.id) {
                    target = survivors[Math.floor(Math.random() * survivors.length)];
                }
                processEvent(actor, target);
            }
            updateSimStatus();
        }

        function processEvent(actor, target) {
            // ë¡œì§ ë™ì¼
            if (actor.id === target.id) {
                heal(actor, 'hp', 15);
                heal(actor, 'stamina', 10);
                addLog(`ğŸ’¤ <b>${actor.name}</b>(ì€)ëŠ” íœ´ì‹ì„ ì·¨í•˜ë©° ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤.`);
                return;
            }

            const relation = actor.relations[target.name] || 0;
            const dice = Math.random() * 100;
            
            // 1. ê³µê²© (í˜¸ê°ë„ -20 ë¯¸ë§Œ or ê³µê²©ì„± 70ì´ˆê³¼+ìš´)
            if (relation < -20 || (actor.stats.aggro > 70 && dice < 50)) {
                addLog(`<span class="tag-event" style="color:#e74c3c;">[ì¶©ëŒ]</span> <b>${actor.name}</b>(ì´)ê°€ <b>${target.name}</b>ì—ê²Œ ì‹¸ì›€ì„ ê²ë‹ˆë‹¤!`);
                
                const actorPower = actor.stats.strength + actor.stats.agility + actor.stats.aggro + (Math.random()*30);
                const targetPower = target.stats.strength + target.stats.agility + target.stats.stamina + (Math.random()*30);

                if (actorPower > targetPower) {
                    const dmg = Math.floor(actor.stats.strength / 2) + 5;
                    damage(target, dmg);
                    changeRelation(actor, target, -15);
                    changeRelation(target, actor, -25);
                    addLog(`Result: ğŸ—¡ï¸ <b>${actor.name}</b>ì˜ ìŠ¹ë¦¬! ${target.name}ì—ê²Œ ${dmg}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤.`);
                } else {
                    addLog(`Result: ğŸ›¡ï¸ <b>${target.name}</b>(ì´)ê°€ ê³µê²©ì„ ê°€ë³ê²Œ í”¼í–ˆìŠµë‹ˆë‹¤.`);
                    damage(actor, 3); 
                }
            } 
            // 2. ìš°í˜¸ (í˜¸ê°ë„ 20 ì´ˆê³¼ or ì–‘ì‹¬ 60ì´ˆê³¼+ìš´)
            else if (relation > 20 || (actor.stats.conscience > 60 && dice < 60)) {
                addLog(`<span class="tag-event" style="color:#27ae60;">[í˜‘ë ¥]</span> <b>${actor.name}</b>(ì´)ê°€ <b>${target.name}</b>ë¥¼ ë•ìŠµë‹ˆë‹¤.`);
                changeRelation(actor, target, 5);
                changeRelation(target, actor, 10);
                heal(target, 'sanity', 15);
                addLog(`Result: <b>${target.name}</b>ì˜ ì •ì‹ ë ¥ì´ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
            // 3. ì¼ìƒ
            else {
                addLog(`ğŸ’¬ <b>${actor.name}</b>(ì™€)ê³¼ <b>${target.name}</b>(ì´)ê°€ ëŒ€í™”ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.`);
                changeRelation(actor, target, 2);
                changeRelation(target, actor, 2);
            }
        }

        function changeRelation(from, to, amount) {
            if (!from.relations[to.name]) from.relations[to.name] = 0;
            from.relations[to.name] += amount;
        }

        function damage(char, amount) {
            char.stats.hp -= amount;
            if (char.stats.hp <= 0) {
                char.stats.hp = 0;
                addLog(`ğŸ’€ <b>${char.name}</b>ë‹˜ì´ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤...`);
            }
        }

        function heal(char, statType, amount) {
            const max = statType === 'hp' ? char.stats.maxHp : 
                        statType === 'sanity' ? char.stats.maxSanity : 
                        statType === 'stamina' ? char.stats.maxStamina : 999;
            char.stats[statType] += amount;
            if (char.stats[statType] > max) char.stats[statType] = max;
        }

        function addLog(html) {
            const win = document.getElementById('log-window');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = html;
            win.appendChild(entry);
            win.scrollTop = win.scrollHeight;
        }

        function updateSimStatus() {
            const container = document.getElementById('sim-status');
            container.innerHTML = characters.map(c => {
                const hpPercent = (c.stats.hp / c.stats.maxHp) * 100;
                const isDead = c.stats.hp <= 0;
                return `
                <div class="char-card" style="${isDead ? 'opacity:0.5; background:#ddd;' : ''}">
                    <div class="char-name">${c.name} ${isDead?'(ì‚¬ë§)':''}</div>
                    <div class="stat-row">
                        <span>HP: ${c.stats.hp}</span>
                        <span>ì •ì‹ : ${c.stats.sanity}</span>
                    </div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${hpPercent}%; background:${hpPercent<30?'red':'#4a90e2'}"></div></div>
                </div>
            `}).join('');
        }

        function autoPlay() {
            if (isAutoPlaying) return;
            isAutoPlaying = true;
            const timer = setInterval(() => {
                if (!isAutoPlaying || characters.filter(c=>c.stats.hp>0).length < 1) {
                    clearInterval(timer);
                    isAutoPlaying = false;
                } else {
                    nextTurn();
                }
            }, 1000); 
        }

        checkPoints();
    </script>
</body>
</html>
